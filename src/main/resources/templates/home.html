<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
    	<title>ShopCart Sample</title>
    	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    	<!--link rel="stylesheet" type="text/css" th:href="@{}" /-->
    </head>
	<body>
		<h2>Products List</h2>
		<table>
			<thead>
				<tr>
					<th>Description</th>
					<th>Price</th>
					<th>Quantity</th>
					<th>Add to cart</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="product: ${products}">
					<td th:text="${product.id}" style="display: none;"></td>
					<td th:text="${product.description}"></td>
					<td th:text="${product.price}"></td>
					<td>
						<input type="text" value="1" />
					</td>
					<td><button class="btn-add-to-cart">Add Item</button></td>
				</tr>
			</tbody>
		</table>
		
		<h2>Cart Shopping</h2>
		<table id="cart-table">
			<thead>
				<tr>
					<th>Description</th>
					<th>Price</th>
					<th>Quantity</th>
					<th>Remove from cart</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="cartItem: ${cart.itens}">
					<td th:text="${cartItem.product.id}" style="display: none;"></td>
					<td th:text="${cartItem.product.description}"></td>
					<td th:text="${cartItem.product.price}"></td>
					<td th:text="${cartItem.quantity}"></td>
					<td><a href="javascript:;" class="btn-remove-from-cart"> X </a></td>
				</tr>
			</tbody>
		</table>
		<script type="text/javascript" th:src="@{/jquery-3.4.1.min.js}"></script>
		<script type="text/javascript">
			$(function() {
				$('.btn-add-to-cart').click(function() {
					var produtoInfo = $(this).parents('tr')[0].getElementsByTagName('td');
					var produtoQuantity = produtoInfo[3].getElementsByTagName('input');
					
					var cartItem = {
						product: {
							id: produtoInfo[0].innerHTML,
							description: produtoInfo[1].innerHTML,
							price: produtoInfo[2].innerHTML
						},
						quantity: produtoQuantity[0].value
					};
					
					addToCart(cartItem);
				});
				
				function addToCart(cartItem) {
					$.ajax({
						type: 'POST',
						url: '/ws/add-to-cart',
						contentType: 'application/json',
						data: JSON.stringify(cartItem),
						success: function(data) {
							$('#cart-table tbody')
							.append($('<tr>')
								.append($('<td style="display: none;">').text(data.product.id))
								.append($('<td>').text(data.product.description))
								.append($('<td>').text(data.product.price))
								.append($('<td>').text(data.quantity))
								.append($('<td>')
									.append('<a>').attr('class', 'btn-remove-from-cart').html(' X ')
								)
							);
						},
						error: function (error) {
				            console.log("ERROR : ", error);
				        }
					});
				}
			});
		</script>
	</body>
</html>